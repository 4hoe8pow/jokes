---
layout: ../../layouts/ProjectLayout.astro
title: ğŸ« é¹¿ã & ShikakuMLS ä¼ç”»è¦æ—¨
description: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·å¯¾å¿œã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ç«¯æœ«å®ŒçµMLSãƒ©ã‚¤ãƒ–ãƒ©ãƒª
tags: ["Google Cloud", "CryptoKit", "E2EE", "MLS"]
timestamp: 2025-09-18T11:46:00+00:00
featured: false
filename: shikaku
---

<img width="1024" height="1024" alt="Generated Image September 19, 2025" src="https://github.com/user-attachments/assets/b1143078-0a46-4936-b9a7-3a8499c10892" />

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã€Œé¹¿ãã€ã¨ã€ŒShikakuMLSã€ã¯ã€ã‚»ã‚­ãƒ¥ã‚¢ã§è²¬ä»»ã‚ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã™ã‚‹2ã¤ã®ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

| åç§°      | å½¹å‰²ãƒ»æ©Ÿèƒ½ |
| :-------- | :--------- |
| **é¹¿ã** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆUI/UXï¼‰ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Push/Pullåˆ¶å¾¡ã€SwiftDataã«ã‚ˆã‚‹æš—å·æ–‡ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€è¡¨ç¤ºæ™‚å¾©å·ã€AIã«ã‚ˆã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è£å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’æä¾›ã™ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  |
| **ShikakuMLS (OSS)** | ç«¯æœ«å†…å®Œçµå‹E2EEãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚1:1é€šä¿¡å‘ã‘Double Ratchetã€ã‚°ãƒ«ãƒ¼ãƒ—é€šä¿¡å‘ã‘MLSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€éµç®¡ç†ã€Forward Secrecyä¿è¨¼ã€æš—å·åŒ–ãƒ»å¾©å·å‡¦ç†ã‚’æä¾›ã™ã‚‹OSSãƒ©ã‚¤ãƒ–ãƒ©ãƒª |

---

## 2. ä¸»ä½“

| å†…éƒ¨åç§° | ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ©ãƒ™ãƒ«ä¾‹ | æœ€å¤§äººæ•° | ç”¨é€” |
| -------- | ------------------ | -------- | ---- |
| **ãƒ¦ãƒ¼ã‚¶** | å€‹äºº | 1 | 1:1æ—¥æ¬¡ä¼šè©±ã€ãƒ‡ã‚¤ãƒ­ã‚°ãƒã‚±ãƒƒãƒˆç®¡ç† |
| **ãƒˆãƒ«ãƒ¼ãƒ— (Troop)** | å°è¦æ¨¡ã‚°ãƒ«ãƒ¼ãƒ— | 14 | ãƒ‡ã‚¤ãƒ­ã‚°ãƒã‚±ãƒƒãƒˆç®¡ç†ã€æ—¥æ¬¡é›‘è«‡ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç”¨é€” |
| **ã‚³ãƒ›ãƒ¼ãƒˆ (Cohort)** | ãƒãƒ¼ãƒ ï¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | 500 | ãƒˆãƒ”ãƒƒã‚¯ãƒã‚±ãƒƒãƒˆç®¡ç†ã€ä¸­é•·æœŸçš„è­°è«–ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ |

---

## 3. ãƒã‚±ãƒƒãƒˆç¨®é¡ã¨é‹ç”¨

### ãƒ‡ã‚¤ãƒ­ã‚°ãƒã‚±ãƒƒãƒˆ

- æ—¥æ¬¡å˜ä½ã§ä¼šè©±ã‚’è¨˜éŒ²
- å½“æ—¥ã«åˆå›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ™‚ã«è‡ªå‹•èµ·ç¥¨
- é‹ç”¨ä¸»ä½“: ãƒ¦ãƒ¼ã‚¶1äººã¨ã®1:1ã€ã¾ãŸã¯ãƒˆãƒ«ãƒ¼ãƒ— (æœ€å¤§14äºº)
- å½“æ—¥åˆ†ã®ã¿æ›¸ãè¾¼ã¿å¯èƒ½ï¼ˆè‡ªå‹•æ—¥æ¬¡ç· ã‚ï¼‰
- å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ãŒé–²è¦§å¯èƒ½

### ãƒˆãƒ”ãƒƒã‚¯ãƒã‚±ãƒƒãƒˆ

- ç‰¹å®šã®è­°é¡Œãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç´ã¥ã
- é‹ç”¨ä¸»ä½“: ã‚³ãƒ›ãƒ¼ãƒˆ (æœ€å¤§500äºº)
- æ—¥æ¬¡ç· ã‚ãªã—ï¼ˆé•·æœŸãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³å¯ï¼‰
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡å¯èƒ½ï¼ˆç‰¹å®šäººç‰©ã€å½¹è·ã€å…¨å…¬é–‹ãªã©ï¼‰

---

## 4. UIè¨­è¨ˆæ–¹é‡

- ãƒ›ãƒ¼ãƒ ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ–æ§‹æˆ

1. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¨æ‰€å±ãƒˆãƒ«ãƒ¼ãƒ—ä¸€è¦§
2. ãƒ‡ã‚¤ãƒ­ã‚°ï¼ˆ1:1ãƒ»ãƒˆãƒ«ãƒ¼ãƒ—ä¼šè©±ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºï¼‰  
3. ã‚³ãƒ›ãƒ¼ãƒˆåˆ¥ãƒˆãƒ”ãƒƒã‚¯ï¼ˆãƒˆãƒ”ãƒƒã‚¯ãƒã‚±ãƒƒãƒˆç®¡ç†ï¼‰  
4. ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ä¸€è¦§
5. è¨­å®š

- ãƒ‡ã‚¤ãƒ­ã‚°ã¨ãƒˆãƒ”ãƒƒã‚¯ã‚³ãƒ›ãƒ¼ãƒˆã®UIã¯æ˜ç¢ºã«åŒºåˆ¥
- Pushæ¨©/Pushãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶åº¦ãŠã‚ˆã³AIè£å®šçµæœã‚’è‡ªç„¶ã«è¡¨ç¤º
- botå‘¼ã³å‡ºã—æ¨©é™ã¯ãƒã‚±ãƒƒãƒˆä½œæˆæ™‚ã«è¨­å®šå¯èƒ½

---

## 5. ãƒ‡ãƒ¼ã‚¿ä¿å­˜è¨­è¨ˆ

| ä¿å­˜å¯¾è±¡ | å†…å®¹ | å½¢å¼ | TTL/æœŸé™ | å‚™è€ƒ |
| -------- | ---- | ---- | -------- | ---- |
| æš—å·åŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | AES-GCMæš—å·æ–‡ | ãƒã‚¤ãƒŠãƒª | 30ã€œ90æ—¥ | å¹³æ–‡ã¯è¡¨ç¤ºæ™‚ã®ã¿å¾©å·ã€ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ã§æ°¸ç¶šåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
| ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ | UIDã€ãƒã‚±ãƒƒãƒˆIDã€é€ä¿¡æ—¥æ™‚ã€ç½²åãƒãƒƒã‚·ãƒ¥ç­‰ | JSON | æ°¸ç¶š(WORM) | æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨é€” |
| AIè£å®šãƒ­ã‚° | æ‰¿èªçµæœã€é€¸è„±ã‚¹ã‚³ã‚¢ã€æ¨æ•²å±¥æ­´ | JSON | æœ€å¤§90æ—¥ | ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ã§ã¯æ°¸ç¶šåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
| Pushæ¨©å±¥æ­´ | å›è»¢æƒ…å ±ã€ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ­ã‚° | JSON | ç´„90æ—¥ | å…¬å¹³æ€§UXç¶­æŒã€é‹ç”¨å±¥æ­´ã®é€æ˜æ€§ç¢ºä¿ |
| ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¨¼è·¡ | RFC3161æº–æ‹ TSã€Ed25519ç½²å | JSON/ç½²å | æ°¸ç¶š(WORM) | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®éå¦èªæ€§ä¿è¨¼ |

- SwiftDataã«ã¯æš—å·åŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨æ¤œç´¢ãƒ»è¡¨ç¤ºç”¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜  
- å¹³æ–‡ã¯ç«¯æœ«ãƒ¡ãƒ¢ãƒªä¸Šã§å¾©å·ã€ä¸€æ™‚çš„ã«å‡¦ç†ã•ã‚Œæ°¸ç¶šåŒ–ã—ãªã„

---

## 6. æš—å·åŒ–æˆ¦ç•¥

| é€šä¿¡å½¢å¼ | ãƒ—ãƒ­ãƒˆã‚³ãƒ« | éµäº¤æ› | å¯¾ç§°æš—å· | ç½²åãƒ»éå¦èªæ€§ |
| -------- | ---------- | ------ | -------- | -------------- |
| 1:1é€šä¿¡ | Double Ratchet | X25519 | AES-GCM | Ed25519 |
| ã‚°ãƒ«ãƒ¼ãƒ— (3ã€œ21äºº) | MLS (TreeKEM + Sender Key) | X25519 | AES-GCM | Ed25519 |

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¹³æ–‡ã¯è¡¨ç¤ºæ™‚ã®ã¿ç«¯æœ«ã§å¾©å·  
- MLSã«ã‚ˆã‚ŠForward Secrecyã¨Post-Compromise Securityã‚’ä¿è¨¼  
- ShikakuMLSå…¬é–‹APIçµŒç”±ã§æš—å·åŒ–ãƒ»å¾©å·å‡¦ç†ã‚’å®Ÿè¡Œ

---

## 7. ShikakuMLSã®é–‹ç™ºä¼ç”»

- Swift + CryptoKitã§å®Ÿè£…ã€OSSã¨ã—ã¦Apache 2.0ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§å…¬é–‹äºˆå®š
- 1:1é€šä¿¡ç”¨ Double Ratchetã€ã‚°ãƒ«ãƒ¼ãƒ—é€šä¿¡ç”¨ MLS (RFC9420æº–æ‹ ) ã‚’ã‚µãƒãƒ¼ãƒˆ
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¹³æ–‡ã‚’æ°¸ç¶šåŒ–ã—ãªã„è¨­è¨ˆ
- Forward Secrecyã€ã‚°ãƒ«ãƒ¼ãƒ—åŠ å…¥/è„±é€€å¾Œã®éµæ›´æ–°ã‚’è‡ªå‹•ç®¡ç†

---

## 8. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| å±¤ | æŠ€è¡“ | å‚™è€ƒ |
| --- | --- | --- |
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | Swift 6, SwiftUI, CryptoKit, SwiftData | æœ€æ–°Appleã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ  |
| AIè£å®š | Rakuten AI 2.0 mini (CoreML) | ç«¯æœ«å†…æ¨è«–ã€ä½é…å»¶ãƒ»ä½ã‚³ã‚¹ãƒˆãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­· |
| æš—å· | ShikakuMLS (Swift Package, CryptoKit) | ç«¯æœ«å®Œçµå‹E2EEã€OSSãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| ã‚µãƒ¼ãƒãƒ¼ | Google Cloud (Cloud Functions, Firestore, KMS/HSM) | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»è¨¼è·¡ä¿å­˜ç®¡ç† |

---

## 9. é¹¿ãæœ¬ä½“å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ ï¼ˆå…¬é–‹éµäº¤æ›å«ã‚€ï¼‰  
2. ãƒã‚±ãƒƒãƒˆä½œæˆï¼ˆãƒ‡ã‚¤ãƒ­ã‚° or ãƒˆãƒ”ãƒƒã‚¯ãƒã‚±ãƒƒãƒˆï¼‰  
3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆãƒ»AIè£å®š  
4. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸Pushï¼ˆshikakuMLSæš—å·åŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’Cloud Run FunctionsçµŒç”±ã§ç™»éŒ²ï¼‰  
5. å—ä¿¡è€…Pullï¼ˆæš—å·æ–‡ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’SwiftDataã«ä¿å­˜ï¼‰  
6. è¡¨ç¤ºæ™‚å¾©å·ï¼ˆshikakuMLSå¾©å·ï¼‰  
7. Pushæ¨©å›è»¢ãƒ»å±¥æ­´è¨˜éŒ²  
8. ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¨¼è·¡ç”Ÿæˆãƒ»ä¿å­˜ï¼ˆRFC3161æº–æ‹ ã€Ed25519ç½²åï¼‰

---

## 10. ä»Šå¾Œã®æ‹¡å¼µ

- å¤šè¨€èªå¯¾å¿œUI/UXãƒ»AIè£å®šå¤šè¨€èªåŒ–  
- çµ„ç¹”å‘ã‘ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå“è³ªãƒ»ãƒã‚±ãƒƒãƒˆæ¶ˆåŒ–çŠ¶æ³å¯è¦–åŒ–ï¼‰  
- æ–‡ç« åŠ›å‘ä¸Šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆAIè£å®šé€£å‹•ï¼‰  
- ShikakuMLSé«˜åº¦æ©Ÿèƒ½ï¼ˆç¾¤è„±é€€æ™‚éµæ›´æ–°è‡ªå‹•æ¤œè¨¼ã€PCSä¿è¨¼å¼·åŒ–ï¼‰

## 11. è£œéº

### 11.1 ç«¯æœ«å†…AIè£å®šãƒ¢ãƒ‡ãƒ«å®Ÿè£…ä¾‹

```swift
import Foundation
import CoreML

final class LLMManager {
    static let shared = LLMManager()
    
    // Rakuten AI 2.0 miniç”¨
    private let modelFileName = "rakutenai-2mini-quantized.mlmodelc"
    private let remoteModelURLString = "https://huggingface.co/Rakuten/RakutenAI-2mini-quantized/resolve/main/rakutenai-2mini-quantized.mlmodel"
    
    private var mlModel: MLModel?
    
    private var localURL: URL? {
        do {
            let fileManager = FileManager.default
            let appSupportDir = try fileManager.url(for: .applicationSupportDirectory, in: .userDomainMask, appropriateFor: nil, create: true)
            return appSupportDir.appendingPathComponent(modelFileName)
        } catch {
            print("ApplicationSupportDirectoryå–å¾—å¤±æ•—: \(error)")
            return nil
        }
    }
    
    // MARK: - ãƒ¢ãƒ‡ãƒ«æº–å‚™
    func prepareModel(completion: @escaping (Error?) -> Void) {
        guard let localURL = localURL else {
            completion(NSError(domain: "LLMManager", code: 0, userInfo: [NSLocalizedDescriptionKey: "ãƒ¢ãƒ‡ãƒ«ä¿å­˜å…ˆä¸æ˜"]))
            return
        }
        
        if FileManager.default.fileExists(atPath: localURL.path) {
            loadCoreMLModel(from: localURL, completion: completion)
            return
        }
        
        downloadAndCompileModel(to: localURL, completion: completion)
    }
    
    private func downloadAndCompileModel(to localURL: URL, completion: @escaping (Error?) -> Void) {
        guard let url = URL(string: remoteModelURLString) else {
            completion(NSError(domain: "LLMManager", code: 1, userInfo: [NSLocalizedDescriptionKey: "URLä¸æ­£"]))
            return
        }
        
        let task = URLSession.shared.downloadTask(with: url) { tempURL, _, error in
            if let error = error {
                completion(error)
                return
            }
            guard let tempURL = tempURL else {
                completion(NSError(domain: "LLMManager", code: 2, userInfo: [NSLocalizedDescriptionKey: "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—"]))
                return
            }
            
            do {
                if FileManager.default.fileExists(atPath: localURL.path) {
                    try FileManager.default.removeItem(at: localURL)
                }
                try FileManager.default.moveItem(at: tempURL, to: localURL)
                let compiledURL = try MLModel.compileModel(at: localURL)
                self.loadCoreMLModel(from: compiledURL, completion: completion)
            } catch {
                completion(error)
            }
        }
        task.resume()
    }
    
    private func loadCoreMLModel(from url: URL, completion: @escaping (Error?) -> Void) {
        do {
            let config = MLModelConfiguration()
            
            // ç«¯æœ«æ€§èƒ½ã«å¿œã˜ãŸè¨­å®š
            if ProcessInfo.processInfo.physicalMemory < 3_000_000_000 { // 3GBæœªæº€
                config.computeUnits = .cpuOnly
                config.allowLowPrecisionAccumulationOnGPU = false
            } else {
                config.computeUnits = .all
                config.allowLowPrecisionAccumulationOnGPU = true
            }
            
            mlModel = try MLModel(contentsOf: url, configuration: config)
            completion(nil)
        } catch {
            completion(error)
        }
    }
    
    // MARK: - æ¨è«–
    func predict(text: String, chunkSize: Int = 128, completion: @escaping (String) -> Void) {
        prepareModel { error in
            if let error = error {
                print("ãƒ¢ãƒ‡ãƒ«æº–å‚™å¤±æ•—: \(error)")
                completion("")
                return
            }
            
            guard let mlModel = self.mlModel else {
                completion("")
                return
            }
            
            DispatchQueue.global(qos: .userInitiated).async {
                var result = ""
                let chunks = text.chunked(by: chunkSize) // ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²
                
                for chunk in chunks {
                    do {
                        let input = try MLDictionaryFeatureProvider(dictionary: ["prompt": chunk])
                        let output = try mlModel.prediction(from: input)
                        let textOutput = output.featureValue(for: "text")?.stringValue ?? chunk
                        result += textOutput
                    } catch {
                        print("æ¨è«–å¤±æ•—: \(error)")
                        result += chunk
                    }
                }
                
                DispatchQueue.main.async {
                    completion(result)
                }
            }
        }
    }
    
    // MARK: - ãƒ¢ãƒ‡ãƒ«è§£æ”¾
    func unloadModel() {
        mlModel = nil
    }
}

// MARK: - æ–‡å­—åˆ—ãƒãƒ£ãƒ³ã‚¯åŒ–æ‹¡å¼µ
extension String {
    func chunked(by size: Int) -> [String] {
        var chunks: [String] = []
        var startIndex = self.startIndex
        while startIndex < self.endIndex {
            let endIndex = self.index(startIndex, offsetBy: size, limitedBy: self.endIndex) ?? self.endIndex
            chunks.append(String(self[startIndex..<endIndex]))
            startIndex = endIndex
        }
        return chunks
    }
}
```
